# ğŸ“˜ **8.4 RAG ë¬¸ì„œ ì²˜ë¦¬ ìš”ì²­ (ë°±ì—”ë“œ â†’ AI ì„œë²„)**

**(ë¬¸ì„œ ì—…ë¡œë“œ ì´í›„ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” ë‚´ë¶€ API)**

## âœ” url

**POST /ai/rag/process**

ë°±ì—”ë“œê°€ AI ì„œë²„ë¡œ í˜¸ì¶œí•˜ëŠ” APIì´ë¯€ë¡œ

Gatewayë¥¼ í†µê³¼í•˜ì§€ ì•Šê±°ë‚˜

íŠ¹ìˆ˜í•œ ë‚´ë¶€ ì¸ì¦ í† í°ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

---

### âœ” ì„¤ëª…

`POST /rag/documents/upload`ê°€ ì„±ê³µí•˜ë©´,

ë°±ì—”ë“œì—ì„œëŠ” ì¦‰ì‹œ AI ì„œë²„ë¡œ ì•„ë˜ ì‘ì—…ì„ ìš”ì²­í•œë‹¤:

1. ì›ë³¸ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ(fileUrl)
2. í…ìŠ¤íŠ¸ ì¶”ì¶œ (pdf â†’ text, hwp â†’ text ë“±)
3. í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬ (í—¤ë”/í‘¸í„° ì œê±°, ë¶ˆí•„ìš”í•œ ê°œí–‰ ì œê±° ë“±)
4. ì²­í¬ ë¶„í• (chunking)
5. ì„ë² ë”© ìƒì„±
6. DB ì €ì¥(rag_document_chunk, rag_fail_chunk)

AI ì„œë²„ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ ê°€ëŠ¥í•˜ë©°, ì²˜ë¦¬ ìƒíƒœëŠ” result callbackì„ í†µí•´ ë°±ì—”ë“œë¡œ ì „ë‹¬í•  ìˆ˜ë„ ìˆìŒ.

---

### âœ” ê¶Œí•œ

`ROLE_SYSTEM`

ë˜ëŠ”

**Internal-API-Token** í—¤ë”ë¡œ ë³´í˜¸

ì˜ˆ)

```
X-Internal-Token: {secret}

```

---

# ğŸ“Œ **Request**

| key         | ì„¤ëª…            | íƒ€ì…             | Nullable | ì˜ˆì‹œ                       |
| ----------- | --------------- | ---------------- | -------- | -------------------------- |
| documentId  | rag_document PK | number           | false    | `101`                      |
| title       | ë¬¸ì„œ ì œëª©       | string           | false    | `"ì‚°ì—…ì•ˆì „ ê·œì •ì§‘"`        |
| domain      | ë¬¸ì„œ ë„ë©”ì¸     | string           | false    | `"HR"`                     |
| fileUrl     | ì›ë³¸ ë¬¸ì„œ URL   | string           | false    | `"https://s3.../file.pdf"` |
| requestedAt | ìš”ì²­ ì‹œê°       | string(datetime) | false    | `"2025-01-01T12:00:00"`    |

---

### ğŸ“Œ Request Example

```json
{
  "documentId": 101,
  "title": "ì‚°ì—…ì•ˆì „ ê·œì •ì§‘",
  "domain": "HR",
  "fileUrl": "https://s3.company.com/rag/docs/hr-guide-v3.pdf",
  "requestedAt": "2025-01-01T12:00:00"
}
```

---

# ğŸ“Œ **Response**

AI ì„œë²„ëŠ” ì¦‰ì‹œ ackë§Œ ë°˜í™˜(ë¹„ë™ê¸° ì²˜ë¦¬)

| key      | ì„¤ëª…                     | íƒ€ì…    | ì˜ˆì‹œ                   |
| -------- | ------------------------ | ------- | ---------------------- |
| accepted | ì²˜ë¦¬ ìš”ì²­ ì •ìƒ ìˆ˜ì‹  ì—¬ë¶€ | boolean | true                   |
| jobId    | ë‚´ë¶€ ì‘ì—… ì‹ë³„ì         | string  | `"rag-process-239912"` |
| status   | ì´ˆê¸° ìƒíƒœ                | string  | `"QUEUED"`             |

---

### ğŸ“Œ Response Example

```json
{
  "accepted": true,
  "jobId": "rag-process-239912",
  "status": "QUEUED"
}
```

---

# ğŸ“Œ **Status**

| status                        | ì˜ë¯¸                              |
| ----------------------------- | --------------------------------- |
| **202 Accepted**              | ìš”ì²­ ì •ìƒ ì ‘ìˆ˜ (ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì‘) |
| **400 Bad Request**           | í•„ìˆ˜ ê°’ ëˆ„ë½                      |
| **401 Unauthorized**          | ë‚´ë¶€ ì¸ì¦ ì‹¤íŒ¨                    |
| **403 Forbidden**             | ê¶Œí•œ ë¶€ì¡±                         |
| **500 Internal Server Error** | ì²˜ë¦¬ ìš”ì²­ ì‹¤íŒ¨                    |
